<!DOCTYPE html>
<html lang="en" style="visibility: visible;">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="style.css">
  <title>Walls</title>
  <script src="http://code.jquery.com/jquery-1.10.2.min.js"></script>
  <script src="main.js" type="text/javascript"></script>
  <script>
    window.onload = function() {
      var canvas = document.createElement("canvas");
      var context = canvas.getContext("2d");
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
      document.body.appendChild(canvas);
      var img = new Image;
      img.onload = function() {
        context.drawImage(img,x(),y(),100,100);
      }
      img.src = 'https://chart.googleapis.com/chart?chs=547x547&cht=qr&chl=http://quickresponse.tumblr.com&chld=L|1&choe=UTF-8';

      var posX = Math.random() * canvas.width,
          posY = Math.random() * canvas.height;

      var particles = {},
          particleIndex = 0,
          settings = {
            density: 5,
            particleSize: 5,
            startingX: x(),
            startingY: y(),
            gravity: 0,
            maxLife: 1500,
            groundLevel: canvas.height,
            leftWall: -200,
            rightWall: canvas.width
          };
      var seedsX = [];
      var seedsY = [];
      var maxAngles = 100;
      var currentAngle = 0;

      function x() {
        return(Math.random() * canvas.width);
      }
      function y() {
        return(Math.random() * canvas.height);
      }

      function seedAngles() {
        seedsX = [];
        seedsY = [];
        for (var i = 0; i < maxAngles; i++) {
          seedsX.push(Math.random() * 50 - Math.random() * 50);
          seedsY.push(Math.random() * 50 - Math.random() * 50);
        }
      }

      seedAngles();

      function Particle() {
        if (currentAngle !== maxAngles) {
          this.x = x();
          this.y = y();

          this.vx = seedsX[currentAngle];
          this.vy = seedsY[currentAngle];

          currentAngle++;

          particleIndex ++;
          particles[particleIndex] = this;
          this.id = particleIndex;
          this.life = 0;
          this.maxLife = settings.maxLife;
        } else {
          console.log('Generating more seed angles');
          seedAngles();
          currentAngle = 0;
        }
      }

      Particle.prototype.draw = function() {
        this.x += this.vx;
        this.y += this.vy;
        
        if ((this.y + settings.particleSize) > settings.groundLevel) {
          this.vy *= -0.6;
          this.vx *= 0.75;
          this.y = settings.groundLevel - settings.particleSize;
        }

        if (this.x - (settings.particleSize) <= settings.leftWall) {
          this.vx *= -1;
          this.x = settings.leftWall + (settings.particleSize);
        }

        if (this.x + (settings.particleSize) >= settings.rightWall) {
          this.vx *= -1;
          this.x = settings.rightWall - settings.particleSize;
        }

        this.life++;

        if (this.life >= this.maxLife) {
          delete particles[this.id];
        }
        context.clearRect(settings.leftWall, settings.groundLevel, canvas.width, canvas.height);
        context.drawImage(img,this.x,this.y,100,100);
      }

      setInterval(function() {
        // context.fillStyle = "#fff";
        // context.fillRect(0, 0, canvas.width, canvas.height);

        for (var i = 0; i < settings.density; i++) {
          new Particle();
        }

        for (var i in particles) {
          particles[i].draw();
        }
      }, 30);
    };
  </script>
</head>
  <body cz-shortcut-listen="true">
  </body>
</html>